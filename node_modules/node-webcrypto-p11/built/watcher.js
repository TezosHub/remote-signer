"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const graphene_pk11_1 = require("graphene-pk11");
const utils_1 = require("./utils");
function printError(err) {
    const obj = {
        message: err.message,
        name: err.name,
        stack: err.stack,
    };
    console.log(JSON.stringify(obj).replace(/\\/g, "\\\\"));
}
let error = false;
try {
    const libPath = process.argv[2];
    const mod = graphene_pk11_1.Module.load(libPath);
    try {
        mod.initialize();
        const slots = mod.getSlots(true);
        const info = {
            name: mod.libraryDescription,
            providers: [],
        };
        for (let i = 0; i < slots.length; i++) {
            const slot = slots.items(i);
            const provider = utils_1.getProviderInfo(slot);
            info.providers.push(provider);
        }
        console.log(JSON.stringify(info));
    }
    catch (err) {
        error = true;
        printError(err);
    }
    mod.finalize();
}
catch (err) {
    if (!error) {
        printError(err);
    }
}
